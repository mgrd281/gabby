<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GABBY | Intelligent Regulator</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Cairo:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #00f3ff;
            --secondary: #ff0055;
            --bg: #050510;
            --panel: #13141f;
            --glass: rgba(19, 20, 31, 0.8);
            --border: 1px solid rgba(0, 243, 255, 0.2);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg);
            color: #fff;
            text-align: center;
            padding: 20px;
            margin: 0;
            background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #050510 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--glass);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.1);
            backdrop-filter: blur(10px);
            border: var(--border);
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        p.subtitle {
            color: #aaa;
            margin-top: 0;
            font-size: 0.9em;
            letter-spacing: 1px;
        }

        /* --- Login Overlay --- */
        #loginOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 16, 0.95);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(15px);
        }

        #loginBox {
            background: var(--panel);
            padding: 40px;
            border-radius: 15px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
            text-align: center;
            width: 90%;
            max-width: 350px;
        }

        #passInput {
            padding: 15px;
            font-size: 1.2em;
            border-radius: 8px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
            width: 80%;
            margin-bottom: 20px;
            text-align: center;
            outline: none;
            transition: 0.3s;
        }

        #passInput:focus {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.3);
        }

        #loginBtn {
            padding: 12px 40px;
            background: linear-gradient(45deg, var(--primary), #00a8ff);
            color: #000;
            font-weight: bold;
            border: none;
            font-family: 'Orbitron', sans-serif;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: 0.3s;
        }

        #loginBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
        }

        .locked {
            filter: blur(8px);
            pointer-events: none;
        }

        /* --- Dashboard Grid --- */
        .machine-face {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 30px 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .screen {
            background: #000;
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        /* Scanline effect */
        .screen::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .screen.red-text {
            color: var(--secondary);
            text-shadow: 0 0 10px var(--secondary);
        }

        .screen.yellow-text {
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }

        .screen-val {
            font-size: 2.5em;
            display: block;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .screen-label {
            font-size: 0.7em;
            color: #666;
            display: block;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .screen.main {
            grid-column: span 3;
            border: 1px solid rgba(255, 215, 0, 0.3);
            background: radial-gradient(circle, rgba(255, 215, 0, 0.05) 0%, rgba(0, 0, 0, 1) 80%);
        }

        .screen.main .screen-val {
            font-size: 4em;
        }

        .screen.main.danger-state {
            border-color: var(--secondary);
            color: var(--secondary);
            animation: pulseRed 1s infinite alternate;
        }

        @keyframes pulseRed {
            from {
                box-shadow: 0 0 10px var(--secondary);
            }

            to {
                box-shadow: 0 0 30px var(--secondary);
            }
        }

        /* --- Controls --- */
        .controls-area {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }

        .control-panel {
            flex: 1;
            background: var(--panel);
            padding: 20px;
            border-radius: 15px;
            text-align: right;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .control-panel h3 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            font-size: 1em;
            font-family: 'Orbitron', sans-serif;
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            height: 8px;
            background: #333;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary);
        }

        /* --- Output Status & Relays --- */
        .output-relay {
            background: rgba(39, 174, 96, 0.2);
            width: 100%;
            max-width: 250px;
            padding: 15px;
            border-radius: 50px;
            margin: 20px auto;
            font-weight: bold;
            border: 2px solid #2ecc71;
            color: #2ecc71;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.2);
            transition: 0.3s;
        }

        .output-relay.off {
            background: rgba(192, 57, 43, 0.2);
            border-color: var(--secondary);
            color: var(--secondary);
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.3);
        }

        .output-relay.wait {
            background: rgba(243, 156, 18, 0.2);
            border-color: #f39c12;
            color: #f39c12;
        }

        .relays {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .relay-box {
            padding: 10px;
            background: #1a1a1a;
            border-radius: 5px;
            width: 70px;
            font-size: 0.8em;
            transition: all 0.3s;
            border: 1px solid #333;
            color: #555;
            font-family: 'Orbitron', sans-serif;
        }

        .relay-box.active {
            background: #e67e22;
            color: #fff;
            border-color: #f39c12;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4);
        }

        /* --- Schematic --- */
        .schematic-box {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 20px;
            margin-top: 30px;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .schematic-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: linear-gradient(#1a1a1a 1px, transparent 1px), linear-gradient(90deg, #1a1a1a 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            pointer-events: none;
        }

        .schematic-title {
            font-family: 'Orbitron', sans-serif;
            color: #555;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* --- Mobile --- */
        @media (max-width: 600px) {
            .machine-face {
                grid-template-columns: 1fr 1fr;
            }

            .screen.main {
                grid-column: span 2;
            }

            .screen[style*="grid-column: span 3;"] {
                grid-column: span 2 !important;
            }

            .controls-area {
                flex-direction: column;
            }

            .screen-val {
                font-size: 1.8em;
            }

            .screen.main .screen-val {
                font-size: 2.5em;
            }
        }
    </style>
</head>

<body>

    <!-- Login Overlay -->
    <div id="loginOverlay">
        <div id="loginBox">
            <h2 style="color:var(--primary); margin-top:0; font-family: 'Orbitron';">SYSTEM LOCKED</h2>
            <p style="color:#aaa;">AUTHENTICATION REQUIRED</p>
            <input type="password" id="passInput" placeholder="ENTER PASSWORD">
            <br>
            <button id="loginBtn" onclick="checkPass()">ACCESS SYSTEM</button>
            <p id="errorMsg" style="color:var(--secondary); display:none; margin-top:15px; font-weight:bold;">ACCESS
                DENIED</p>
        </div>
    </div>

    <div class="container locked" id="mainContainer">
        <h1>GABBY <span style="font-size:0.5em; vertical-align:middle; color:#fff;">SYSTEMS</span></h1>
        <p class="subtitle">16-STAGE INTELLIGENT REGULATOR</p>

        <div class="machine-face">
            <div class="screen main yellow-text" id="screenMain">
                <span class="screen-val" id="dispOut">220</span>
                <span class="screen-label">OUTPUT VOLTAGE (V)</span>
            </div>
            <div class="screen">
                <span class="screen-val" id="dispIn">160</span>
                <span class="screen-label">INPUT (V)</span>
            </div>
            <div class="screen red-text">
                <span class="screen-val" id="dispAmps">12.5</span>
                <span class="screen-label">CURRENT (A)</span>
            </div>
            <div class="screen">
                <span class="screen-val" id="dispStep">11</span>
                <span class="screen-label">STAGE</span>
            </div>
            <div class="screen" style="grid-column: span 3;">
                <span class="screen-val" id="dispTimer">0</span>
                <span class="screen-label">SAFETY TIMER</span>
            </div>
        </div>

        <!-- Output Relay Status -->
        <div id="outputRelayBox" class="output-relay">
            SYSTEM ACTIVE
        </div>

        <div class="controls-area">
            <div class="control-panel">
                <h3>GRID VOLTAGE</h3>
                <input type="range" id="voltageSlider" min="130" max="320" value="160">
                <div style="display:flex; justify-content:space-between; margin-top:10px; color:#666; font-size:0.8em;">
                    <span>130V</span><span>320V</span>
                </div>
            </div>
            <div class="control-panel">
                <h3>LOAD DEMAND</h3>
                <input type="range" id="loadSlider" min="0" max="5000" value="2000" step="100">
                <div id="loadText"
                    style="margin-top:10px; color:var(--primary); font-family:'Orbitron'; font-size:1.2em;">2000W</div>
            </div>
        </div>

        <div class="relays">
            <div class="relay-box" id="r4">R4<br>80V</div>
            <div class="relay-box" id="r3">R3<br>40V</div>
            <div class="relay-box" id="r2">R2<br>20V</div>
            <div class="relay-box" id="r1">R1<br>10V</div>
        </div>

        <div class="schematic-box">
            <div class="schematic-title">LM358 PRECISION SENSOR</div>
            <svg class="diagram-svg" viewBox="0 0 500 250">
                <defs>
                    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur stdDeviation="2" result="blur" />
                        <feComposite in="SourceGraphic" in2="blur" operator="over" />
                    </filter>
                </defs>
                <circle cx="50" cy="120" r="25" class="component"
                    style="stroke:#ff0055; stroke-width:3; fill:none; filter:url(#glow);" />
                <text x="35" y="125" class="component-text" style="fill:#ff0055;">CT</text>
                <rect x="75" y="100" width="10" height="40" class="component" />
                <text x="70" y="90" class="component-text">BURDEN</text>
                <path d="M 200 80 L 200 160 L 280 120 Z" class="opamp" style="stroke:var(--primary); fill:#111;" />
                <text x="210" y="105" class="component-text" style="font-size:16px;">-</text>
                <text x="210" y="145" class="component-text" style="font-size:16px;">+</text>
                <text x="220" y="125" class="component-text" style="fill:#fff; font-weight:bold;">LM358</text>
                <rect x="380" y="80" width="80" height="80" class="component" style="fill:#0055aa; stroke:#00a8ff;" />
                <text x="390" y="100" class="component-text" style="font-weight:bold">MCU</text>
                <text x="400" y="130" class="component-text">ADC</text>
                <path d="M 85 120 L 140 120 L 140 140 L 200 140" class="wire" />
                <path d="M 280 120 L 320 120 L 320 60 L 160 60 L 160 100 L 200 100" class="wire"
                    style="stroke-dasharray: 4; opacity:0.5;" />
                <path d="M 320 120 L 380 120" class="wire" />
                <path d="M 50 145 L 50 180 L 380 180" class="wire" style="stroke:#444" />
            </svg>
        </div>
    </div>

    <script>
        const TARGET = 220;
        const OFFSET = -80;
        const CUTOFF_LIMIT = 250;

        // Elements
        const elIn = document.getElementById('dispIn');
        const elOut = document.getElementById('dispOut');
        const elAmps = document.getElementById('dispAmps');
        const elStep = document.getElementById('dispStep');
        const elTimer = document.getElementById('dispTimer');
        const elLoadText = document.getElementById('loadText');
        const elRelayBox = document.getElementById('outputRelayBox');
        const elScreenMain = document.getElementById('screenMain');

        const sliderV = document.getElementById('voltageSlider');
        const sliderL = document.getElementById('loadSlider');

        // System State
        let timerVal = 5.0; // Seconds
        let isTimerActive = true;
        let systemLoop = null;

        function runSystem() {
            let vin = parseInt(sliderV.value);
            let loadWatts = parseInt(sliderL.value);
            elLoadText.innerText = loadWatts + "W";

            // 1. Calculate Est Vout
            let bestStage = 0;
            let minErr = 9999;
            let bestVout = vin;

            for (let i = 0; i < 16; i++) {
                let corr = 0;
                if (i & 1) corr += 10;
                if (i & 2) corr += 20;
                if (i & 4) corr += 40;
                if (i & 8) corr += 80;
                let est = vin + corr + OFFSET;
                if (Math.abs(TARGET - est) < minErr) {
                    minErr = Math.abs(TARGET - est);
                    bestStage = i;
                    bestVout = est;
                }
            }

            // 2. Logic Machine
            if (bestVout > CUTOFF_LIMIT) {
                isTimerActive = true;
                timerVal = 5.0;

                elOut.innerText = "HI";
                elScreenMain.className = "screen main yellow-text danger-state";
                elRelayBox.className = "output-relay off";
                elRelayBox.innerText = "DANGER: CUTOFF";
                elAmps.innerText = "0.0";

            } else if (isTimerActive) {
                timerVal -= 0.1;
                if (timerVal <= 0) {
                    isTimerActive = false;
                    timerVal = 0;
                }

                elOut.innerText = "---";
                elScreenMain.className = "screen main yellow-text";
                elRelayBox.className = "output-relay wait";
                elRelayBox.innerText = "PROTECTION WAIT...";
                elAmps.innerText = "0.0";

            } else {
                elOut.innerText = bestVout;
                elScreenMain.className = "screen main yellow-text";
                elRelayBox.className = "output-relay";
                elRelayBox.innerText = "SYSTEM ACTIVE";

                let amps = (bestVout > 50) ? (loadWatts / bestVout).toFixed(1) : "0.0";
                elAmps.innerText = amps;
            }

            elIn.innerText = vin;

            // Show Minus for Reduction Stages (0-7)
            if (bestStage < 8) {
                elStep.innerText = "- " + bestStage;
                elStep.style.color = "#00f3ff"; // Cyan for cold/buck
            } else {
                elStep.innerText = bestStage;
                elStep.style.color = "#0f0";
            }

            elTimer.innerText = Math.ceil(timerVal);

            document.getElementById('r1').className = 'relay-box ' + ((bestStage & 1) ? 'active' : '');
            document.getElementById('r2').className = 'relay-box ' + ((bestStage & 2) ? 'active' : '');
            document.getElementById('r3').className = 'relay-box ' + ((bestStage & 4) ? 'active' : '');
            document.getElementById('r4').className = 'relay-box ' + ((bestStage & 8) ? 'active' : '');
        }

        // Login Function
        function checkPass() {
            const pass = document.getElementById('passInput').value;
            if (pass === "Gabby2026") {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainContainer').classList.remove('locked');
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }

        // Run Logic every 100ms
        setInterval(runSystem, 100);

    </script>
</body>

</html>